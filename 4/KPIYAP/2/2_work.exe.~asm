.model small
.stack 100h
.data
start_msg db "Enter a string:",10,13,'$'
word_number db "<number>"
string  db 201
db ?
db 201 dup(?)
.code
get_length proc
pop ax
pop bx
sub ax, bx
push ax
ret
get_length endp

left_shift_with_insert macro count, str, word  ;//8, string, <number>
pop dx                                  ;//–¥–æ—Å—Ç–∞—ë–º –∫–æ–Ω–µ—Ü —Å–ª–æ–≤–∞
push di                                 ;//—Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω–µ—Ü —Å–ª–æ–≤–∞
push si                                 ;//—Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–±–µ–ª
mov si, dx
xor ax, ax
mov al, byte ptr [str + 1]
mov di, offset str + 2
add di, ax
inc di
shift_loop:
dec di
mov al, byte ptr ds:[di]
mov byte ptr ds:[di+8], al
cmp di, si
je  _insert_word
jmp shift_loop
_insert_word:
mov di, offset word
xor cx, cx
mov cx, 8
_insert_word_loop:
mov al, [di]
mov [si], al
inc di
inc si
loop _insert_word_loop

mov si, dx
xor ax, ax
mov al, byte ptr [str + 1]
mov di, offset str + 2
add di, ax
add di,8
add si,8
inc di
xor cx,cx

_loop_this:
dec di
cmp di, si
jne _loop_this
inc cx
mov ah, ' '
mov al, [di]
cmp ah,al
je _exit_shift
mov ah, '$'
mov al, [di]
cmp ah,al
je _exit_shift

_swap_to_end:
mov al, byte ptr ds:[di+1]
mov byte ptr ds:[di], al
inc di
mov ah, '$'
mov al, [di]
cmp ah,al
jne _swap_to_end
jmp _loop_this

jmp _exit_shift
_exit_shift:
pop si
pop di
endm


_start:
mov ax, @data
mov ds, ax

_start_msg:                                ;//–í—ã–≤–æ–¥ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
mov dx, offset start_msg
mov ah, 0x9
int 0x21
mov dx, offset string                ;//–í–≤–æ–¥ —Å—Ç—Ä–æ–∫–∏
mov ah, 0x0A
int 21h

_check_string_length:
xor ah, ah
xor si, si
mov si, offset string + 1
mov al, byte ptr[si]
cmp al, 200                            ;//–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ 200—Å–∏–º–≤–æ–ª–æ–≤
jae _exit_without_output
cmp al, 0                            ;//–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ 0 —Å–∏–º–≤–æ–ª–æ–≤
je _exit_without_output
jmp _replace_enter

_replace_enter:
xor si, si
mov si, offset string + 1
xor ch, ch
mov cl, [si]
inc cx
add si,cx                           ;//—É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –Ω–∞ –¥–ª–∏–Ω—É string+2
mov al, '$'
mov [si], al                        ;//–î–æ–±–∞–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª –≤ –∫–æ–Ω–µ—Ü

_prepare_for_searching_words:
mov di, offset string + 2
xor ax, ax
mov al, 32                          ;//—É–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–±–µ–ª
xor cx, cx
mov cl, byte ptr[string + 1]        ;//–ø–µ—Ä–µ–¥–∞—ë–º —Å—Å—ã–ª–∫—É –Ω–∞ –Ω–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏
inc cx
jmp _find_word                      ;// al = ' ', cl=&string

_inc_dest_index:
mov di, si                         ;//–ø–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª
inc di
xor ax, ax
mov ah, '$'
mov al, [di]                        ;//—Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å –∫–æ–Ω—Ü–æ–º —Å—Ç—Ä–æ–∫–∏
inc di
pop cx
cmp ah, al
je _exit
jmp _find_word

_find_word:
push di                         ;//–∑–∞–≥–æ–Ω—è–µ–º –≤ —Å—Ç–µ–∫ di = string+2
jmp _start_searching_word       ;// ss = {di=string+2}

_start_searching_word:
mov ah, [di]                    ;//–ø–µ—Ä–µ–¥–∞—ë–º –ø–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª –∏–∑ di –≤ ah, –ø—Ä–∏ —ç—Ç–æ–º al=' '
inc di
cmp al, ah
je _check_is_number             ;//–Ω–∞—à–ª–∏ –ø—Ä–æ–±–µ–ª
loop _start_searching_word
jmp _check_is_number            ;//–∫–æ–Ω–µ—Ü —Å—Ç—Ä–æ–∫–∏


_check_is_number_last:
dec di
mov si, di
pop di
push cx
xor dx, dx
mov dx, di
dec di
xor ax, ax
cmp di, si
je _inc_dest_index
jmp _start_cheking_last

_start_cheking_last:
cmp di, si
je _out_founded_word
inc di
mov ah, "0"
mov al, [di]
cmp al, ah
jl _exit
mov ah, "9"
cmp al, ah
jg _exit
jmp _start_cheking_last

_check_is_number:
dec cx
sub di, 2                   ;//—Ä–∞–∑–Ω–æ—Å—Ç—å
mov si, di                  ;//–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —Å–∏–≤–æ–ª–∞
pop di
push cx
xor dx, dx
mov dx, di                  ;//–∑–∞–ø–æ–º–∏–Ω–∞–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞
dec di
xor ax, ax
cmp di, si
je _inc_dest_index
jmp _start_cheking

_start_cheking:
cmp di, si                  ;//si = ' ',di = string
je _insert_word_number
inc di
mov ah, "0"
mov al, [di]
cmp al, ah
jl _inc_dest_index
mov ah, "9"
cmp al, ah
jg _inc_dest_index
jmp _start_cheking

_insert_word_number:
push dx                     ;//–≤ —Å—Ç–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–Ω–µ—Ü —Å–ª–æ–≤–∞ (—á–∏—Å–ª–∞)
left_shift_with_insert 8, string, word_number
dec cx
sub si, cx
add di, 8
add si, 8
xor ax, ax
mov al, byte ptr[string+1]
add al, 8
sub al, ch
mov byte ptr[string+1], al
jmp _inc_dest_index



_out_founded_word:
mov di, dx
dec di
xor dx, dx
jmp _print_word
_print_word:
inc di
mov dl, [di]
mov ah, 0x2
int 0x21
cmp si, di
jne _print_word
je _inc_dest_index

_exit_without_output:
mov ah, 0x4c
int 0x21

_exit:
mov dl, 10;
mov ah, 0x02;
int 0x21
mov dl, 13;
mov ah, 0x02;
int 0x21
mov dx, offset string + 2
mov ah, 0x09
int 0x21
mov ah, 0x4c
int 0x21
end _start



; [SOURCE]: D:\”ÌË‚Â\4 ÒÂÏÂÒÚ\ œËﬂœ\2\2.asm
